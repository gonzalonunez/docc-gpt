# DoccGPT

DoccGPT is an experiment in self-documenting Swift code by leveraging [OpenAI](https://platform.openai.com/docs/api-reference/edits) and [DocC](https://developer.apple.com/documentation/docc), Apple's documentation compiler:

> The DocC documentation compiler converts Markdown-based text into rich documentation for Swift and Objective-C projects, and displays it right in the Xcode documentation window. You can also host this documentation on a website.

By pairing DoccGPT together with the wonderful [Swift Package Index](https://blog.swiftpackageindex.com/posts/auto-generating-auto-hosting-and-auto-updating-docc-documentation/), which compiles and hosts your documentation for you, you can come very close to fully automating the documentation of your codebase. DoccGPT writes the documentation for you, or at least does the first-pass, and the Swift Package Index takes care of compiling and hosting the generated documentation for you.

The documentation based on the markup in `/Sources/Example/` was generated by running DoccGPT on itself:
```diff
(Lmao looks like OpenAI removed all models usable with the `/edits` endpoint brb)
```

It's not quite smart enough yet to document itself entirely, as the files in `/Sources/DoccGPT/` are a little more complex, but I'm working on finding the right technique / prompt(s). Any and all help is very much welcome!

## Basic usage
Run the package and give it a directory as well as your [OpenAI secret key](https://platform.openai.com/account/api-keys). 

> **Warning**
> DoccGPT will attempt to rewrite the contents of every single `.swift` file in the directory that you feed it!

```bash
swift run docc-gpt <directory> --key <key>
```
```bash
ARGUMENTS:
  <directory>             The folder whose contents you want to document

OPTIONS:
  -k, --key <key>         Your secret API key for OpenAI
  -h, --help              Show help information.
```

## How it works

DoccGPT is a command-line tool written in Swift that iterates through all `.swift` files in a given directory and attempts to document your code using [DocC](https://developer.apple.com/documentation/docc) syntax:

> DocC syntax — called documentation markup — is a custom variant of Markdown that adds functionality for developer documentation-specific features, like cross-symbol linking, term-definition lists, code listings, and asides.

At the time of writing, the documentation markup is generated by feeding entire `.swift` files to `POST https://api.openai.com/v1/edits` and using the `code-davinci-edit-001` model. The instruction given to the model can be found in `Instruction.swift`. I had initially tried the `/creation` endpoint and other models / prompts, but after discovering `/edits` nothing else came even remotely close. That said, I have not tried using GPT-4 yet.

## FAQ

**What's missing?**
DoccGPT not quite smart enough yet to document more complex files. I think this is entirely to the nature of my prompt and less due to the nature of any particular OpenAI endpoint / model. That said, maybe there are other strategies we could also take, like [fine-tuning](https://platform.openai.com/docs/guides/fine-tuning) a particular model or using [swift-syntax](https://github.com/apple/swift-syntax) to walk the AST and document smaller units of code at a time instead of entire files.

There is also quite a bit of other work needed to take this all of the way to a usable state, like exposing the ability to ignore certain files/directories.

**Would I use this in production?**
Assuming we address the limitations described above, maybe? Although I wouldn't dare to auto-commit anything in CI etc. I would more likely run this once on a given codebase, perhaps a very large one that's not well-documented, and then maintain it myself from there. At best, maybe I would run it in CI on pushes to `master` and have it open PRs automatically.
